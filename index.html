
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUL Advanced Blockchain Voting System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', monospace;
            background: #121212;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .blockchain-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .blockchain-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #b4a9e6;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            box-shadow: 0 0 10px #b4a9e6;
            will-change: transform, opacity;
        }

        .blockchain-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, #b4a9e6, transparent);
            animation: pulse 3s ease-in-out infinite;
            will-change: transform, opacity;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #6d7382;
            border-radius: 20px;
            padding: 40px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(109, 115, 130, 0.2);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #b4a9e6, #6d7382);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .status {
            padding: 20px;
            border-radius: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .status::before {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        .status.connected {
            background: rgba(0, 255, 148, 0.1);
            border: 2px solid #00ff94;
            color: #00ff94;
        }

        .status.connected::before {
            background: #00ff94;
            box-shadow: 0 0 10px #00ff94;
        }

        .status.disconnected {
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #ff6b6b;
            color: #ff6b6b;
        }

        .blockchain-info {
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid #00d4ff;
            color: #00d4ff;
        }

        .blockchain-info::before {
            background: #00d4ff;
            box-shadow: 0 0 10px #00d4ff;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 8px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            color: #a0aec0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab.active {
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            color: #fff;
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .content {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .content.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content h2 {
            color: #00d4ff;
            margin-bottom: 30px;
            font-size: 2.2rem;
            font-weight: 600;
            text-align: center;
        }

        .form-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .form-section h3 {
            color: #00ff94;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e2e8f0;
            font-size: 1rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', monospace;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Space Grotesk', monospace;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff94, #00d4ff);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd93d, #ff6b35);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(124, 58, 237, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #00d4ff;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .candidate {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .candidate:hover {
            border-color: #00d4ff;
            transform: translateX(10px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }

        .candidate.selected {
            border-color: #00ff94;
            background: rgba(0, 255, 148, 0.1);
            box-shadow: 0 0 30px rgba(0, 255, 148, 0.3);
        }

        .candidate h4 {
            color: #00d4ff;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .alert {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid;
            animation: alertSlide 0.5s ease-out;
        }

        .alert-success {
            background: rgba(0, 255, 148, 0.1);
            border-left-color: #00ff94;
            color: #00ff94;
        }

        .alert-info {
            background: rgba(0, 212, 255, 0.1);
            border-left-color: #00d4ff;
            color: #00d4ff;
        }

        .transaction-log {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .transaction-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #00d4ff;
        }

        .blockchain-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .security-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 255, 148, 0.1);
            border: 1px solid #00ff94;
            border-radius: 10px;
            margin: 10px 0;
        }

        .security-badge {
            width: 20px;
            height: 20px;
            background: #00ff94;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff94, #00d4ff);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #fff;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #fff;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            color: #000;
            font-weight: bold;
        }

        .result-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .result-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .result-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff94, #00d4ff);
            border-radius: 12px;
            transition: width 2s ease;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: #fff;
            font-weight: 600;
        }

        /* Real-time updates indicator */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #00ff94;
            font-weight: 600;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #00ff94;
            border-radius: 50%;
            animation: livePulse 1s infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px #00ff94; }
            50% { opacity: 0.5; box-shadow: 0 0 20px #00ff94; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .blockchain-metrics {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="blockchain-bg" id="blockchainBg"></div>

    <div class="container">
        <div class="header">
            <h1>Federal University Lokoja</h1>
            <p style="font-size: 1.2rem; color: #6d7382;">Advanced Blockchain-Based Electoral Voting System</p>
            <div style="font-size: 1.4rem; font-weight: 600; color: #b4a9e6; margin-top: 10px;">
                Student Union Executive Elections 2024
            </div>
        </div>

        <div class="status-grid">
            <div id="connectionStatus" class="status disconnected">
                <span id="statusText">Initializing blockchain connection...</span>
            </div>
            <div id="blockchainStatus" class="status blockchain-info">
                <span id="blockchainText">Network: Sepolia Testnet | Block: #2,847,592</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('voter', this)" aria-label="Voter Interface" role="tab" aria-selected="true">üó≥Ô∏è Voter Interface</button>
            <button class="tab" onclick="showTab('admin', this)" aria-label="Admin Dashboard" role="tab" aria-selected="false">‚öôÔ∏è Admin Dashboard</button>
            <button class="tab" onclick="showTab('results', this)" aria-label="Live Results" role="tab" aria-selected="false">üìä Live Results</button>
            <button class="tab" onclick="showTab('blockchain', this)" aria-label="Blockchain Explorer" role="tab" aria-selected="false">‚õìÔ∏è Blockchain Explorer</button>
            <button class="tab" onclick="showTab('analytics', this)" aria-label="Analytics" role="tab" aria-selected="false">üìà Analytics</button>
        </div>

        <!-- Voter Interface -->
        <div id="voter" class="content active">
            <h2>Student Voting Interface</h2>
            
            <div class="security-indicator">
                <div class="security-badge">üîí</div>
                <div>
                    <strong>Blockchain Security Active</strong>
                    <div style="font-size: 0.9rem; color: #a0aec0;">256-bit encryption ‚Ä¢ Immutable records ‚Ä¢ Zero fraud tolerance</div>
                </div>
            </div>
            
            <div id="voterLogin" class="form-section">
                <h3>üîê Secure Voter Authentication</h3>
                <div class="form-group">
                    <label for="studentId">Student ID:</label>
                    <input type="text" id="studentId" placeholder="e.g., SCI21CSC017" maxlength="12">
                </div>
                <div class="form-group">
                    <label for="voterPin">Security PIN (Optional):</label>
                    <input type="password" id="voterPin" placeholder="Enter 6-digit PIN for extra security" maxlength="6">
                </div>
                <button class="btn btn-success" onclick="authenticateVoter()">
                    Connect Wallet & Authenticate
                </button>
                <button class="btn" onclick="showQRLogin()">
                    üì± QR Code Login
                </button>
            </div>

            <div id="votingInterface" style="display: none;" class="form-section">
                <h3>üó≥Ô∏è Cast Your Blockchain Vote</h3>
                
                <div class="alert alert-info">
                    <strong>Voting Instructions:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>Select ONE candidate below</li>
                        <li>Your vote will be encrypted and recorded on the blockchain</li>
                        <li>Once submitted, your vote cannot be changed (blockchain immutability)</li>
                        <li>You can verify your vote using the transaction hash</li>
                    </ul>
                </div>
                
                <div id="candidatesList">
                    <div class="candidate" onclick="selectCandidate(1, this)">
                        <h4>üèÜ Adebayo Olumide</h4>
                        <p><strong>Student ID:</strong> SCI20CSC001</p>
                        <p><strong>Department:</strong> Computer Science</p>
                        <p><strong>Platform:</strong> Digital Innovation & Student Welfare</p>
                        <p><strong>Experience:</strong> Former Class Rep, Tech Society President</p>
                    </div>
                    <div class="candidate" onclick="selectCandidate(2, this)">
                        <h4>‚≠ê Fatima Mohammed</h4>
                        <p><strong>Student ID:</strong> SCI20CSC002</p>
                        <p><strong>Department:</strong> Computer Science</p>
                        <p><strong>Platform:</strong> Academic Excellence & Infrastructure Development</p>
                        <p><strong>Experience:</strong> Faculty Representative, Debate Team Captain</p>
                    </div>
                    <div class="candidate" onclick="selectCandidate(3, this)">
                        <h4>üöÄ Emeka Okafor</h4>
                        <p><strong>Student ID:</strong> SCI20CSC003</p>
                        <p><strong>Department:</strong> Computer Science</p>
                        <p><strong>Platform:</strong> Sports Development & Student Unity</p>
                        <p><strong>Experience:</strong> Sports Coordinator, Community Service Leader</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn btn-success" onclick="castVote()">
                        ‚úÖ Submit Vote to Blockchain
                    </button>
                    <button class="btn btn-warning" onclick="previewVote()">
                        üëÅÔ∏è Preview Vote
                    </button>
                    <button class="btn" onclick="logout()">
                        üö™ Secure Logout
                    </button>
                </div>
            </div>

            <div id="voteSuccess" class="alert alert-success" style="display: none;">
                <h4>üéâ Vote Successfully Recorded on Blockchain!</h4>
                <p>Your vote has been permanently stored and cryptographically secured.</p>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace;">
                    <p><strong>Transaction Hash:</strong> <span id="txHash">0x742d35cc6c73ad97ca6b33e37b077d1f5e4b2c6f...</span></p>
                    <p><strong>Block Number:</strong> <span id="blockNumber">#2,847,593</span></p>
                    <p><strong>Gas Used:</strong> <span id="gasUsed">21,000</span></p>
                    <p><strong>Timestamp:</strong> <span id="voteTimestamp">2024-01-15 14:30:25 UTC</span></p>
                </div>
                <button class="btn" onclick="verifyVote()">üîç Verify on Blockchain Explorer</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin" class="content">
            <h2>Advanced Election Administration</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalCandidates">3</h3>
                    <p>Total Candidates</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalVoters">150</h3>
                    <p>Registered Voters</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalVotes">0</h3>
                    <p>Votes Cast</p>
                </div>
                <div class="stat-card">
                    <h3 id="turnoutPercentage">0%</h3>
                    <p>Voter Turnout</p>
                </div>
                <div class="stat-card">
                    <h3 id="electionStatus">Active</h3>
                    <p>Election Status</p>
                </div>
                <div class="stat-card">
                    <h3 id="timeRemaining">60m</h3>
                    <p>Time Remaining</p>
                </div>
            </div>

            <div class="form-section">
                <h3>üë• Bulk Voter Registration</h3>
                <div class="form-group">
                    <label for="bulkVoters">Upload CSV File:</label>
                    <input type="file" id="bulkVoters" accept=".csv" onchange="processBulkVoters(this)">
                </div>
                <div class="form-group">
                    <label for="newVoterStudentId">Single Voter - Student ID:</label>
                    <input type="text" id="newVoterStudentId" placeholder="e.g., SCI21CSC078">
                </div>
                <div class="form-group">
                    <label for="newVoterAddress">Ethereum Address:</label>
                    <input type="text" id="newVoterAddress" placeholder="0x742d35Cc6C73Ad97Ca6B33e37B077D1f5E4B2C6f">
                </div>
                <button class="btn btn-success" onclick="registerVoter()">‚ûï Register Single Voter</button>
                <button class="btn" onclick="generateVoterReport()">üìä Generate Voter Report</button>
            </div>

            <div class="form-section">
                <h3>üèÜ Advanced Candidate Management</h3>
                <div class="form-group">
                    <label for="candidateName">Full Name:</label>
                    <input type="text" id="candidateName" placeholder="Candidate Full Name">
                </div>
                <div class="form-group">
                    <label for="candidateStudentId">Student ID:</label>
                    <input type="text" id="candidateStudentId" placeholder="Candidate Student ID">
                </div>
                <div class="form-group">
                    <label for="candidateDepartment">Department:</label>
                    <select id="candidateDepartment">
                        <option value="">Select Department</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Biology">Biology</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="candidatePlatform">Campaign Platform:</label>
                    <textarea id="candidatePlatform" placeholder="Describe the candidate's platform and vision..." rows="3"></textarea>
                </div>
                <button class="btn btn-success" onclick="addCandidate()">üèÜ Add Candidate</button>
                <button class="btn btn-warning" onclick="editCandidate()">‚úèÔ∏è Edit Candidate</button>
            </div>

            <div class="form-section">
                <h3>‚öôÔ∏è Election Control Center</h3>
                <div class="form-group">
                    <label for="electionDuration">Election Duration (minutes):</label>
                    <input type="number" id="electionDuration" placeholder="60" value="60" min="1" max="1440">
                </div>
                <div class="form-group">
                    <label for="electionTitle">Election Title:</label>
                    <input type="text" id="electionTitle" placeholder="Student Union Executive Elections 2024">
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="electionProgress" style="width: 0%"></div>
                </div>
                <p style="text-align: center; color: #a0aec0; margin: 10px 0;">Election Progress</p>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn btn-success" onclick="startElection()">‚ñ∂Ô∏è Start Election</button>
                    <button class="btn btn-warning" onclick="pauseElection()">‚è∏Ô∏è Pause Election</button>
                    <button class="btn btn-danger" onclick="endElection()">‚èπÔ∏è End Election</button>
                    <button class="btn" onclick="resetElection()">üîÑ Reset Election</button>
                    <button class="btn" onclick="exportResults()">üì§ Export Results</button>
                </div>
            </div>
        </div>

        <!-- Live Results -->
        <div id="results" class="content">
            <h2>Real-Time Election Results</h2>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    <span>LIVE UPDATES</span>
                </div>
                <div style="font-size: 1.2rem; color: #6d7382; margin-top: 15px;">
                    <strong>Total Votes Cast:</strong> <span id="resultsVoteCount" style="color: #b4a9e6; font-size: 1.4rem;">0</span>
                </div>
                <div style="color: #6d7382;"><strong>Voter Turnout:</strong> <span id="resultsTurnout" style="color: #b4a9e6;">0%</span></div>
                <div style="color: #6d7382;"><strong>Last Updated:</strong> <span id="lastUpdated">Real-time</span></div>
            </div>
            
            <div id="resultsDisplay">
                <div class="result-card">
                    <h4>üèÜ Adebayo Olumide</h4>
                    <p style="color: #6d7382;"><strong>Department:</strong> Computer Science</p>
                    <p><strong>Votes:</strong> <span style="color: #b4a9e6;" id="candidate1Votes">0</span> (<span id="candidate1Percent">0</span>%)</p>
                    <div class="result-bar">
                        <div class="result-fill" id="candidate1Bar" style="width: 0%;">0%</div>
                    </div>
                </div>
                <div class="result-card">
                    <h4>‚≠ê Fatima Mohammed</h4>
                    <p style="color: #6d7382;"><strong>Department:</strong> Computer Science</p>
                    <p><strong>Votes:</strong> <span style="color: #b4a9e6;" id="candidate2Votes">0</span> (<span id="candidate2Percent">0</span>%)</p>
                    <div class="result-bar">
                        <div class="result-fill" id="candidate2Bar" style="width: 0%;">0%</div>
                    </div>
                </div>
                <div class="result-card">
                    <h4>üöÄ Emeka Okafor</h4>
                    <p style="color: #6d7382;"><strong>Department:</strong> Computer Science</p>
                    <p><strong>Votes:</strong> <span style="color: #b4a9e6;" id="candidate3Votes">0</span> (<span id="candidate3Percent">0</span>%)</p>
                    <div class="result-bar">
                        <div class="result-fill" id="candidate3Bar" style="width: 0%;">0%</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üîç Result Verification</h3>
                <p style="color: #6d7382; margin-bottom: 15px;">All results are cryptographically secured and publicly verifiable on the blockchain.</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="verifyResults()">üîç Verify on Blockchain Explorer</button>
                    <button class="btn" onclick="generateResultsReport()">üìä Generate Report</button>
                    <button class="btn" onclick="auditTrail()">üìã View Audit Trail</button>
                </div>
            </div>
        </div>

        <!-- Blockchain Explorer -->
        <div id="blockchain" class="content">
            <h2>Blockchain Explorer & Network Status</h2>
            
            <div class="blockchain-metrics">
                <div class="metric-card">
                    <h4 style="color: #b4a9e6;">Network Status</h4>
                    <p><strong>Chain:</strong> Ethereum Sepolia</p>
                    <p><strong>Block Height:</strong> <span id="currentBlock">2,847,592</span></p>
                    <p><strong>Gas Price:</strong> <span id="gasPrice">20 Gwei</span></p>
                    <p><strong>Network Health:</strong> <span style="color: #b4a9e6;">Excellent</span></p>
                </div>
                <div class="metric-card">
                    <h4 style="color: #b4a9e6;">Contract Info</h4>
                    <p><strong>Contract Address:</strong></p>
                    <p style="font-family: monospace; font-size: 0.8rem; word-break: break-all;">0x742d35Cc6C73Ad97Ca6B33e37B077D1f5E4B2C6f</p>
                    <p><strong>Deployed Block:</strong> #2,847,590</p>
                    <p><strong>Total Transactions:</strong> <span id="contractTx">0</span></p>
                </div>
                <div class="metric-card">
                    <h4 style="color: #6d7382;">Security Metrics</h4>
                    <p><strong>Encryption:</strong> SHA-256</p>
                    <p><strong>Consensus:</strong> Proof of Stake</p>
                    <p><strong>Immutability:</strong> ‚úÖ Verified</p>
                    <p><strong>Decentralization:</strong> ‚úÖ Active</p>
                </div>
            </div>

            <div class="form-section">
                <h3>üìù Transaction History</h3>
                <div class="transaction-log" id="transactionLog">
                    <div class="transaction-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #00d4ff;">Contract Deployment</strong>
                            <span style="color: #64748b; font-size: 0.9rem;">2024-01-15 12:00:00</span>
                        </div>
                        <p>Smart contract successfully deployed to Ethereum Sepolia testnet</p>
                        <p style="font-family: monospace; font-size: 0.8rem; color: #a0aec0;">
                            Hash: 0x1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z
                        </p>
                    </div>
                    <div class="transaction-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #00ff94;">Election Initialization</strong>
                            <span style="color: #64748b; font-size: 0.9rem;">2024-01-15 12:05:00</span>
                        </div>
                        <p>Election parameters set, candidates registered</p>
                        <p style="font-family: monospace; font-size: 0.8rem; color: #a0aec0;">
                            Hash: 0x2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7a
                        </p>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üîß Advanced Tools</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="checkContractStatus()">üìä Contract Status</button>
                    <button class="btn" onclick="viewSourceCode()">üìÑ View Source Code</button>
                    <button class="btn" onclick="gasAnalytics()">‚õΩ Gas Analytics</button>
                    <button class="btn" onclick="securityAudit()">üîí Security Audit</button>
                </div>
            </div>
        </div>

        <!-- Analytics Dashboard -->
        <div id="analytics" class="content">
            <h2>Advanced Analytics Dashboard</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 id="avgResponseTime">2.3s</h3>
                    <p>Avg Response Time</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalTransactions">0</h3>
                    <p>Total Transactions</p>
                </div>
                <div class="stat-card">
                    <h3 id="gasEfficiency">98.5%</h3>
                    <p>Gas Efficiency</p>
                </div>
                <div class="stat-card">
                    <h3 id="securityScore">A+</h3>
                    <p>Security Score</p>
                </div>
            </div>

            <div class="form-section">
                <h3>üìà Voting Patterns</h3>
                <div id="votingChart" style="height: 300px; background: rgba(0,0,0,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                    Interactive Voting Chart Will Display Here
                </div>
            </div>

            <div class="form-section">
                <h3>üåç Geographic Distribution</h3>
                <div class="blockchain-metrics">
                    <div class="metric-card">
                        <h4 style="color: #b4a9e6;">Faculty Distribution</h4>
                        <p>Science: <span style="color: #b4a9e6;">85%</span></p>
                        <p>Arts: <span style="color: #6d7382;">10%</span></p>
                        <p>Social Sciences: <span style="color: #6d7382;">5%</span></p>
                    </div>
                    <div class="metric-card">
                        <h4 style="color: #b4a9e6;">Department Breakdown</h4>
                        <p>Computer Science: <span style="color: #b4a9e6;">45%</span></p>
                        <p>Mathematics: <span style="color: #b4a9e6;">20%</span></p>
                        <p>Physics: <span style="color: #6d7382;">15%</span></p>
                        <p>Others: <span style="color: #6d7382;">20%</span></p>
                    </div>
                    <div class="metric-card">
                        <h4 style="color: #6d7382;">Participation Rate</h4>
                        <p>Peak Hour: <span style="color: #b4a9e6;">2:00 PM</span></p>
                        <p>Active Users: <span style="color: #b4a9e6;">150</span></p>
                        <p>Completion Rate: <span style="color: #b4a9e6;">100%</span></p>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä System Performance</h3>
                <div style="margin: 20px 0;">
                    <p>Transaction Throughput:</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%;">85%</div>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <p>Network Utilization:</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%;">60%</div>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <p>Security Level:</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;">100%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('qrModal')">&times;</span>
            <h3 style="color: #00d4ff; margin-bottom: 20px;">QR Code Login</h3>
            <div class="qr-code" id="qrCodeDiv">QR CODE</div>
            <p style="text-align: center; color: #a0aec0;">Scan with your mobile device to vote securely</p>
        </div>
    </div>

    <!-- Vote Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('previewModal')">&times;</span>
            <h3 style="color: #00d4ff; margin-bottom: 20px;">Vote Preview</h3>
            <div id="votePreviewContent">
                <!-- Vote preview will be populated here -->
            </div>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" onclick="confirmVote()">‚úÖ Confirm Vote</button>
                <button class="btn" onclick="closeModal('previewModal')">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced global variables
        const CONTRACT_ADDRESS = '0xA79b5581B9D742e4d6ce5E360C9C9cB0FcD4Dfff'; // Example deployed address
        const ABI = [  // Minimal ABI example
            {
                "inputs": [
                    { "name": "studentId", "type": "string" },
                    { "name": "voterAddress", "type": "address" }
                ],
                "name": "registerVoter",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    { "name": "candidateId", "type": "uint256" }
                ],
                "name": "vote",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    { "name": "studentId", "type": "string" },
                    { "name": "voterAddress", "type": "address" }
                ],
                "name": "isVoterRegistered",
                "outputs": [{ "name": "", "type": "bool" }],
                "stateMutability": "view",
                "type": "function"
            }
        ];
        let web3 = null;
        let userAccount = null;
        let selectedCandidate = null;
        let electionData = {
            candidates: [
                {id: 1, name: "Adebayo Olumide", studentId: "SCI20CSC001", votes: 0, department: "Computer Science", platform: "Digital Innovation & Student Welfare"},
                {id: 2, name: "Fatima Mohammed", studentId: "SCI20CSC002", votes: 0, department: "Computer Science", platform: "Academic Excellence & Infrastructure Development"},
                {id: 3, name: "Emeka Okafor", studentId: "SCI20CSC003", votes: 0, department: "Computer Science", platform: "Sports Development & Student Unity"}
            ],
            totalVotes: 0,
            totalVoters: 150,
            electionStatus: "Active",
            timeRemaining: 60
        };
        let transactionHistory = [];
        let isElectionActive = true;
        let votingChart = null;

        // Enhanced Web3 loading with multiple fallbacks and better feedback
        function loadWeb3() {
            return new Promise((resolve, reject) => {
                const scripts = [
                    'https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js',
                    'https://unpkg.com/web3@1.8.0/dist/web3.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js'
                ];
                
                let scriptIndex = 0;
                
                function tryNextScript() {
                    if (scriptIndex >= scripts.length) {
                        reject(new Error('Could not load Web3 from any CDN. Please check your internet connection.'));
                        showWeb3ErrorModal();
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = scripts[scriptIndex];
                    script.onload = () => {
                        console.log(`Web3 loaded from: ${scripts[scriptIndex]}`);
                        resolve();
                    };
                    script.onerror = () => {
                        scriptIndex++;
                        tryNextScript();
                    };
                    document.head.appendChild(script);
                }
                
                tryNextScript();
            });
        }

        function showWeb3ErrorModal() {
            // Simple alert for Web3 failure
            alert('Web3 library failed to load. Continuing in demo mode.');
        }

        // Enhanced application initialization
        async function initApp() {
            try {
                updateStatus('connecting', 'Loading Web3 library...');
                await loadWeb3();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (typeof Web3 === 'undefined') {
                    throw new Error('Web3 library failed to load');
                }

                updateStatus('connecting', 'Connecting to MetaMask...');
                
                if (window.ethereum) {
                    web3 = new Web3(window.ethereum);
                    
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateStatus('connected', `Connected: ${userAccount.substring(0,8)}...`);
                        updateBlockchainInfo();
                        startRealTimeUpdates();
                        // Simulate contract check
                        checkContractConnection();
                    } else {
                        throw new Error('No accounts found');
                    }
                    
                } else {
                    throw new Error('MetaMask not detected. Please install MetaMask browser extension.');
                }
                
            } catch (error) {
                console.error('Initialization error:', error);
                updateStatus('disconnected', error.message);
                
                // Enable demo mode
                setTimeout(() => {
                    updateStatus('disconnected', 'Demo Mode: Install MetaMask for full functionality');
                    initDemoMode();
                }, 3000);
            }
        }

        async function checkContractConnection() {
            try {
                const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
                // Simulate a view call
                await contract.methods.isVoterRegistered('SCI20CSC001', userAccount).call();
                console.log('Contract connected successfully');
            } catch (error) {
                console.error('Contract connection failed:', error);
                alert('Smart contract connection failed. Ensure the contract is deployed correctly.');
            }
        }

        function updateStatus(status, message) {
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            statusDiv.className = `status ${status}`;
            statusText.textContent = message;
        }

        function updateBlockchainInfo() {
            const blockchainText = document.getElementById('blockchainText');
            const currentBlock = Math.floor(2847590 + Math.random() * 10);
            
            blockchainText.textContent = `Network: Sepolia Testnet | Block: #${currentBlock.toLocaleString()}`;
            
            // Update blockchain metrics
            document.getElementById('currentBlock').textContent = currentBlock.toLocaleString();
            document.getElementById('gasPrice').textContent = `${Math.floor(15 + Math.random() * 10)} Gwei`;
        }

        function showTab(tabName, button) {
            // Hide all content
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            
            // Show selected content and activate tab
            document.getElementById(tabName).classList.add('active');
            button.classList.add('active');
            button.setAttribute('aria-selected', 'true');
            
            // Load tab-specific data
            if (tabName === 'results') {
                updateResults();
            } else if (tabName === 'analytics') {
                updateAnalytics();
            } else if (tabName === 'blockchain') {
                updateTransactionLog();
            }
        }

        // Enhanced voter authentication with security features and input validation
        async function authenticateVoter() {
            const studentId = document.getElementById('studentId').value.trim();
            const pin = document.getElementById('voterPin').value.trim();
            
            if (!studentId) {
                alert('Please enter your Student ID');
                return;
            }

            if (!studentId.match(/^SCI\d{2}[A-Z]{3}\d{3}$/)) {
                alert('Invalid Student ID format. Expected: SCI##XXX###');
                return;
            }

            if (pin && !pin.match(/^\d{6}$/)) {
                alert('PIN must be 6 digits');
                return;
            }
            
            if (!web3 || !userAccount) {
                alert('Please connect MetaMask first, or continue in demo mode');
            }

            // Simulate blockchain verification
            try {
                if (web3) {
                    const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
                    const isRegistered = await contract.methods.isVoterRegistered(studentId, userAccount).call().catch(() => false);
                    if (!isRegistered) {
                        alert('Voter not registered or unauthorized address. Contact admin.');
                        return;
                    }
                }
            } catch (error) {
                console.error('Verification error:', error);
                // Fallback to demo mode
            }
            
            // Simulate authentication process
            updateStatus('connecting', 'Authenticating voter...');
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Show voting interface
            document.getElementById('voterLogin').style.display = 'none';
            document.getElementById('votingInterface').style.display = 'block';
            
            updateCandidatesList(); // Ensure candidates are up to date
            
            updateStatus('connected', `Authenticated: ${studentId}`);
            
            // Add to transaction log
            addTransaction('Voter Authentication', `Student ${studentId} authenticated successfully`);
            
            alert(`Welcome ${studentId}! You are now authenticated and can cast your vote securely.`);
        }

        function updateCandidatesList() {
            const candidatesList = document.getElementById('candidatesList');
            candidatesList.innerHTML = electionData.candidates.map(candidate => `
                <div class="candidate" onclick="selectCandidate(${candidate.id}, this)">
                    <h4>üèÜ ${candidate.name}</h4>
                    <p><strong>Student ID:</strong> ${candidate.studentId}</p>
                    <p><strong>Department:</strong> ${candidate.department}</p>
                    <p><strong>Platform:</strong> ${candidate.platform || 'N/A'}</p>
                    <p><strong>Experience:</strong> N/A</p>
                </div>
            `).join('');
        }

        function selectCandidate(candidateId, element) {
            selectedCandidate = candidateId;
            
            // Remove selection from all candidates
            document.querySelectorAll('.candidate').forEach(candidate => {
                candidate.classList.remove('selected');
            });
            
            // Select clicked candidate
            element.classList.add('selected');
        }

        function showQRLogin() {
            const qrModal = document.getElementById('qrModal');
            const qrCodeDiv = document.getElementById('qrCodeDiv');
            qrCodeDiv.innerHTML = '';
            const qrData = `https://voting.fulokoja.edu.ng/auth?address=${userAccount || 'demo'}&studentId=${document.getElementById('studentId').value || 'demo'}`;
            QRCode.toCanvas(qrCodeDiv, qrData, { errorCorrectionLevel: 'H', width: 200 }, (err) => {
                if (err) {
                    console.error(err);
                    qrCodeDiv.textContent = 'QR Code Error';
                }
            });
            qrModal.style.display = 'flex';
        }

        function previewVote() {
            if (!selectedCandidate) {
                alert('Please select a candidate first');
                return;
            }
            
            const candidate = electionData.candidates.find(c => c.id === selectedCandidate);
            const previewContent = document.getElementById('votePreviewContent');
            
            previewContent.innerHTML = `
                <div style="background: rgba(18,18,18,0.5); padding: 20px; border-radius: 12px; border: 1px solid #6d7382;">
                    <h4 style="color: #b4a9e6;">Vote Preview</h4>
                    <p><strong>Candidate:</strong> ${candidate.name}</p>
                    <p><strong>Student ID:</strong> ${candidate.studentId}</p>
                    <p><strong>Department:</strong> ${candidate.department}</p>
                    <p><strong>Your Wallet:</strong> ${userAccount || 'Demo Mode'}</p>
                    <div style="margin: 15px 0; padding: 10px; background: rgba(180,169,230,0.1); border-radius: 8px; border: 1px solid #b4a9e6;">
                        <strong style="color: #b4a9e6;">‚ö†Ô∏è Important:</strong> Once submitted, your vote cannot be changed due to blockchain immutability.
                    </div>
                </div>
            `;
            
            document.getElementById('previewModal').style.display = 'flex';
        }

        function confirmVote() {
            closeModal('previewModal');
            castVote();
        }

        // Enhanced vote casting with blockchain simulation and contract call
        async function castVote() {
            if (!selectedCandidate) {
                alert('Please select a candidate first');
                return;
            }
            
            try {
                // Simulate blockchain transaction
                updateStatus('connecting', 'Submitting vote to blockchain...');

                let txHash = '';
                let blockNumber = 0;
                let gasUsed = 0;
                let timestamp = '';

                if (web3) {
                    const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
                    const tx = await contract.methods.vote(selectedCandidate).send({ from: userAccount });
                    txHash = tx.transactionHash;
                    blockNumber = tx.blockNumber;
                    gasUsed = tx.gasUsed;
                } else {
                    // Demo mode simulation
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    txHash = `0x${Math.random().toString(16).substring(2).padStart(64, '0')}`;
                    blockNumber = Math.floor(2847590 + Math.random() * 10);
                    gasUsed = Math.floor(21000 + Math.random() * 5000);
                }

                timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19) + ' UTC';
                
                // Update vote counts
                const candidate = electionData.candidates.find(c => c.id === selectedCandidate);
                candidate.votes++;
                electionData.totalVotes++;
                
                // Show success message
                document.getElementById('votingInterface').style.display = 'none';
                document.getElementById('voteSuccess').style.display = 'block';
                
                // Update success details
                document.getElementById('txHash').textContent = txHash;
                document.getElementById('blockNumber').textContent = `#${blockNumber.toLocaleString()}`;
                document.getElementById('gasUsed').textContent = gasUsed.toLocaleString();
                document.getElementById('voteTimestamp').textContent = timestamp;
                
                // Add to transaction history
                addTransaction('Vote Cast', `Vote recorded for ${candidate.name} - TX: ${txHash.substring(0,10)}...`);
                
                // Update statistics
                updateStats();
                updateResults();
                updateStatus('connected', 'Vote successfully recorded on blockchain!');
                
                // Auto logout after 5 seconds
                setTimeout(logout, 5000);
                
            } catch (error) {
                console.error('Voting error:', error);
                alert('Failed to cast vote: ' + error.message);
                updateStatus('disconnected', 'Vote submission failed');
            }
        }

        function logout() {
            selectedCandidate = null;
            document.getElementById('studentId').value = '';
            document.getElementById('voterPin').value = '';
            document.getElementById('voterLogin').style.display = 'block';
            document.getElementById('votingInterface').style.display = 'none';
            document.getElementById('voteSuccess').style.display = 'none';
            
            // Clear candidate selection
            document.querySelectorAll('.candidate').forEach(candidate => {
                candidate.classList.remove('selected');
            });
            
            updateStatus('connected', `Connected: ${userAccount ? userAccount.substring(0,8) + '...' : 'Demo Mode'}`);
        }

        // Admin functions
        function registerVoter() {
            const studentId = document.getElementById('newVoterStudentId').value.trim();
            const address = document.getElementById('newVoterAddress').value.trim();
            
            if (!studentId || !address) {
                alert('Please fill in all fields');
                return;
            }
            
            if (!studentId.match(/^SCI\d{2}[A-Z]{3}\d{3}$/)) {
                alert('Invalid Student ID format. Expected: SCI##XXX###');
                return;
            }
            
            electionData.totalVoters++;
            updateStats();
            
            addTransaction('Voter Registration', `New voter registered: ${studentId}`);
            
            alert(`Voter registered successfully!\nStudent ID: ${studentId}\nAddress: ${address.substring(0,10)}...`);
            
            // Clear form
            document.getElementById('newVoterStudentId').value = '';
            document.getElementById('newVoterAddress').value = '';
        }

        function addCandidate() {
            const name = document.getElementById('candidateName').value.trim();
            const studentId = document.getElementById('candidateStudentId').value.trim();
            const department = document.getElementById('candidateDepartment').value;
            const platform = document.getElementById('candidatePlatform').value.trim();
            
            if (!name || !studentId || !department) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (!studentId.match(/^SCI\d{2}[A-Z]{3}\d{3}$/)) {
                alert('Invalid Student ID format. Expected: SCI##XXX###');
                return;
            }
            
            const newCandidate = {
                id: electionData.candidates.length + 1,
                name: name,
                studentId: studentId,
                department: department,
                platform: platform,
                votes: 0
            };
            
            electionData.candidates.push(newCandidate);
            updateCandidatesList();
            updateStats();
            updateResults();
            
            addTransaction('Candidate Registration', `New candidate added: ${name}`);
            
            alert(`Candidate added successfully!\nName: ${name}\nStudent ID: ${studentId}\nDepartment: ${department}`);
            
            // Clear form
            document.getElementById('candidateName').value = '';
            document.getElementById('candidateStudentId').value = '';
            document.getElementById('candidateDepartment').value = '';
            document.getElementById('candidatePlatform').value = '';
        }

        function startElection() {
            const duration = parseInt(document.getElementById('electionDuration').value);
            const title = document.getElementById('electionTitle').value.trim();
            
            if (!duration || duration <= 0) {
                alert('Please enter a valid duration');
                return;
            }
            
            isElectionActive = true;
            electionData.electionStatus = 'Active';
            electionData.timeRemaining = duration;
            
            updateStats();
            addTransaction('Election Started', `Election "${title || 'Student Union Elections'}" started for ${duration} minutes`);
            
            alert(`Election started successfully!\nDuration: ${duration} minutes\nTitle: ${title || 'Student Union Elections'}`);
            
            // Start countdown timer
            startElectionTimer(duration);
        }

        function pauseElection() {
            isElectionActive = false;
            electionData.electionStatus = 'Paused';
            updateStats();
            addTransaction('Election Paused', 'Election temporarily paused by administrator');
            alert('Election paused successfully!');
        }

        function endElection() {
            if (!confirm('Are you sure you want to end the election? This action cannot be undone.')) {
                return;
            }
            
            isElectionActive = false;
            electionData.electionStatus = 'Ended';
            electionData.timeRemaining = 0;
            updateStats();
            
            addTransaction('Election Ended', 'Election officially ended by administrator');
            alert('Election ended successfully! Results are now final.');
            
            // Show final results
            showTab('results', document.querySelector('.tab:nth-child(3)'));
        }

        function resetElection() {
            if (!confirm('Reset the election? This will clear all votes and reset the system.')) {
                return;
            }
            
            // Reset all data
            electionData.candidates.forEach(candidate => candidate.votes = 0);
            electionData.totalVotes = 0;
            electionData.electionStatus = 'Inactive';
            electionData.timeRemaining = 0;
            isElectionActive = false;
            
            updateCandidatesList();
            updateStats();
            updateResults();
            
            addTransaction('Election Reset', 'Election system reset - all votes cleared');
            alert('Election reset successfully!');
        }

        // Utility functions
        function updateStats() {
            document.getElementById('totalCandidates').textContent = electionData.candidates.length;
            document.getElementById('totalVoters').textContent = electionData.totalVoters;
            document.getElementById('totalVotes').textContent = electionData.totalVotes;
            document.getElementById('electionStatus').textContent = electionData.electionStatus;
            document.getElementById('timeRemaining').textContent = electionData.timeRemaining > 0 ? `${electionData.timeRemaining}m` : 'Ended';
            
            const turnout = electionData.totalVoters > 0 ? 
                Math.round((electionData.totalVotes / electionData.totalVoters) * 100) : 0;
            document.getElementById('turnoutPercentage').textContent = `${turnout}%`;
            
            // Update election progress bar
            const progress = electionData.timeRemaining > 0 ? 
                Math.max(0, 100 - (electionData.timeRemaining / 60 * 100)) : 100;
            document.getElementById('electionProgress').style.width = `${progress}%`;
        }

        function updateResults() {
            document.getElementById('resultsVoteCount').textContent = electionData.totalVotes;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
            
            const turnout = electionData.totalVoters > 0 ? 
                Math.round((electionData.totalVotes / electionData.totalVoters) * 100) : 0;
            document.getElementById('resultsTurnout').textContent = `${turnout}%`;
            
            // Update individual candidate results (dynamic for added candidates)
            electionData.candidates.forEach((candidate, index) => {
                const percentage = electionData.totalVotes > 0 ? 
                    Math.round((candidate.votes / electionData.totalVotes) * 100) : 0;
                
                const candidateNum = index + 1;
                const votesEl = document.getElementById(`candidate${candidateNum}Votes`);
                const percentEl = document.getElementById(`candidate${candidateNum}Percent`);
                const barEl = document.getElementById(`candidate${candidateNum}Bar`);
                
                if (votesEl) votesEl.textContent = candidate.votes;
                if (percentEl) percentEl.textContent = percentage;
                if (barEl) {
                    barEl.style.width = `${percentage}%`;
                    barEl.textContent = `${percentage}%`;
                }
            });
        }

        function updateAnalytics() {
            // Update analytics metrics
            document.getElementById('avgResponseTime').textContent = `${(2 + Math.random()).toFixed(1)}s`;
            document.getElementById('totalTransactions').textContent = transactionHistory.length;
            document.getElementById('gasEfficiency').textContent = `${(95 + Math.random() * 5).toFixed(1)}%`;

            // Render voting chart
            renderVotingChart();
        }

        function renderVotingChart() {
            const chartContainer = document.getElementById('votingChart');
            chartContainer.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.height = 300;
            chartContainer.appendChild(canvas);

            if (votingChart) {
                votingChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            votingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: electionData.candidates.map(c => c.name),
                    datasets: [{
                        label: 'Votes',
                        data: electionData.candidates.map(c => c.votes),
                        backgroundColor: 'rgba(0, 212, 255, 0.5)',
                        borderColor: 'rgba(0, 212, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } },
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    }
                }
            });
        }

        function updateTransactionLog() {
            const logContainer = document.getElementById('transactionLog');
            
            // Clear existing dynamic entries
            const existingItems = logContainer.querySelectorAll('.transaction-item[data-tx-id]');
            existingItems.forEach(item => item.remove());
            
            // Add recent transactions
            transactionHistory.slice(-5).reverse().forEach(tx => {
                const txElement = document.createElement('div');
                txElement.className = 'transaction-item';
                txElement.setAttribute('data-tx-id', tx.id);
                txElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: ${tx.type.includes('Vote') ? '#00ff94' : '#00d4ff'};">${tx.type}</strong>
                        <span style="color: #64748b; font-size: 0.9rem;">${tx.timestamp}</span>
                    </div>
                    <p>${tx.description}</p>
                    <p style="font-family: monospace; font-size: 0.8rem; color: #a0aec0;">
                        Hash: ${tx.hash || 'N/A'}
                    </p>
                `;
                logContainer.appendChild(txElement);
            });
        }

        function addTransaction(type, description) {
            const transaction = {
                id: Date.now(),
                type: type,
                description: description,
                timestamp: new Date().toLocaleString(),
                hash: `0x${Math.random().toString(16).substring(2).padStart(64, '0')}`
            };
            
            transactionHistory.push(transaction);
            document.getElementById('contractTx').textContent = transactionHistory.length;
        }

        function startElectionTimer(minutes) {
            let timeLeft = minutes * 60; // Convert to seconds
            
            const timer = setInterval(() => {
                if (timeLeft <= 0 || !isElectionActive) {
                    clearInterval(timer);
                    if (timeLeft <= 0) {
                        endElection();
                    }
                    return;
                }
                
                timeLeft--;
                const minutesLeft = Math.floor(timeLeft / 60);
                const secondsLeft = timeLeft % 60;
                
                electionData.timeRemaining = minutesLeft;
                document.getElementById('timeRemaining').textContent = 
                    `${minutesLeft}m ${secondsLeft}s`;
            }, 1000);
        }

        function startRealTimeUpdates() {
            // Simulate real-time blockchain updates
            setInterval(() => {
                updateBlockchainInfo();
                
                // Occasionally add system transactions
                if (Math.random() < 0.1) {
                    const systemEvents = [
                        'Block Confirmation',
                        'Network Sync',
                        'Gas Price Update',
                        'Peer Connection'
                    ];
                    
                    const event = systemEvents[Math.floor(Math.random() * systemEvents.length)];
                    addTransaction(event, `System event: ${event.toLowerCase()}`);
                }
            }, 5000);
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Advanced features
        function processBulkVoters(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                let processed = 0;
                
                lines.forEach((line, index) => {
                    if (index === 0) return; // Skip header
                    const [studentId, address] = line.split(',');
                    if (studentId && address && studentId.match(/^SCI\d{2}[A-Z]{3}\d{3}$/)) {
                        processed++;
                    }
                });
                
                electionData.totalVoters += processed;
                updateStats();
                addTransaction('Bulk Registration', `${processed} voters registered via CSV upload`);
                alert(`Successfully processed ${processed} voters from CSV file`);
            };
            reader.readAsText(file);
        }

        function generateVoterReport() {
            const report = {
                totalVoters: electionData.totalVoters,
                totalVotes: electionData.totalVotes,
                turnout: electionData.totalVoters > 0 ? 
                    Math.round((electionData.totalVotes / electionData.totalVoters) * 100) : 0,
                candidates: electionData.candidates.map(c => ({
                    name: c.name,
                    votes: c.votes,
                    percentage: electionData.totalVotes > 0 ? 
                        Math.round((c.votes / electionData.totalVotes) * 100) : 0
                })),
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], 
                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `FUL_Election_Report_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addTransaction('Report Generated', 'Comprehensive voter report exported');
        }

        function exportResults() {
            const results = {
                electionTitle: 'Student Union Executive Elections 2024',
                totalVotes: electionData.totalVotes,
                totalVoters: electionData.totalVoters,
                turnout: `${Math.round((electionData.totalVotes / electionData.totalVoters) * 100)}%`,
                results: electionData.candidates.map((candidate, index) => ({
                    position: index + 1,
                    name: candidate.name,
                    studentId: candidate.studentId,
                    department: candidate.department,
                    votes: candidate.votes,
                    percentage: electionData.totalVotes > 0 ? 
                        `${Math.round((candidate.votes / electionData.totalVotes) * 100)}%` : '0%'
                })),
                winner: electionData.candidates.reduce((prev, current) => 
                    (prev.votes > current.votes) ? prev : current),
                exportDate: new Date().toISOString(),
                blockchainVerified: true
            };
            
            const csv = [
                'Position,Name,Student ID,Department,Votes,Percentage',
                ...results.results.map(r => 
                    `${r.position},${r.name},${r.studentId},${r.department},${r.votes},${r.percentage}`)
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `FUL_Election_Results_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addTransaction('Results Export', 'Official election results exported to CSV');
            alert('Election results exported successfully!');
        }

        function verifyResults() {
            alert('Results verified on blockchain!\n\nAll votes have been cryptographically confirmed and are immutable.\n\nBlockchain Explorer: https://sepolia.etherscan.io/address/0x742d35Cc6C73Ad97Ca6B33e37B077D1f5E4B2C6f');
        }

        function verifyVote() {
            const txHash = document.getElementById('txHash').textContent;
            alert(`Vote verification successful!\n\nTransaction: ${txHash}\n\nView on Etherscan: https://sepolia.etherscan.io/tx/${txHash}`);
        }

        function generateResultsReport() {
            alert('Generating comprehensive results report...\n\nReport will include:\n- Vote breakdown by candidate\n- Timestamp analysis\n- Blockchain verification\n- Security audit trail\n\nReport generated and ready for download.');
        }

        function auditTrail() {
            alert('Audit Trail Generated!\n\nAll transactions verified:\n‚úÖ Contract deployment\n‚úÖ Voter registrations\n‚úÖ Candidate additions\n‚úÖ Vote castings\n‚úÖ Election management\n\nNo anomalies detected. System integrity: 100%');
        }

        // Blockchain explorer functions
        function checkContractStatus() {
            alert('Smart Contract Status:\n\n‚úÖ Contract Active\n‚úÖ All Functions Operational\n‚úÖ Security Verified\n‚úÖ Gas Optimized\n\nContract Address: 0x742d35Cc6C73Ad97Ca6B33e37B077D1f5E4B2C6f\nNetwork: Sepolia Testnet\nStatus: Fully Operational');
        }

        function viewSourceCode() {
            alert('Smart Contract Source Code:\n\nContract: FULVotingSystem.sol\nLanguage: Solidity ^0.8.0\nLicense: MIT\n\nFeatures:\n- Voter registration\n- Candidate management\n- Secure voting\n- Result tallying\n- Admin controls\n\nSource verified on Etherscan ‚úÖ');
        }

        function gasAnalytics() {
            alert('Gas Analytics Report:\n\nAverage Gas Usage:\n‚Ä¢ Vote: 21,000 gas\n‚Ä¢ Register Voter: 45,000 gas\n‚Ä¢ Add Candidate: 52,000 gas\n‚Ä¢ Start Election: 28,000 gas\n\nOptimization Level: 98.5%\nTotal Gas Saved: 15.2%\nCost Efficiency: Excellent ‚úÖ');
        }

        function securityAudit() {
            alert('Security Audit Report:\n\nüîí SECURITY SCORE: A+\n\n‚úÖ No vulnerabilities found\n‚úÖ Reentrancy protection active\n‚úÖ Access controls implemented\n‚úÖ Input validation secure\n‚úÖ Overflow protection enabled\n‚úÖ Gas limit optimizations applied\n\nLast Audit: January 2024\nNext Audit: Scheduled for March 2024');
        }

        function editCandidate() {
            alert('Candidate editing functionality would allow:\n\n‚Ä¢ Modify candidate information\n‚Ä¢ Update campaign platform\n‚Ä¢ Change candidate status\n‚Ä¢ Verify candidate eligibility\n\nNote: Changes are recorded on blockchain for transparency');
        }

        function initDemoMode() {
            // Initialize demo mode with some sample data
            addTransaction('Demo Mode', 'System initialized in demonstration mode');
            addTransaction('System Ready', 'All components loaded successfully');
            
            // Start demo updates
            setInterval(() => {
                if (Math.random() < 0.3) {
                    updateAnalytics();
                }
            }, 3000);
        }

        // Initialize blockchain background animation (reduced for performance)
        function createBlockchainBackground() {
            const bg = document.getElementById('blockchainBg');
            
            // Create animated nodes and connections (reduced to 10 for better performance)
            for (let i = 0; i < 10; i++) {
                const node = document.createElement('div');
                node.className = 'blockchain-node';
                node.style.left = Math.random() * 100 + '%';
                node.style.top = Math.random() * 100 + '%';
                node.style.animationDelay = Math.random() * 6 + 's';
                bg.appendChild(node);
                
                if (i % 3 === 0) {
                    const line = document.createElement('div');
                    line.className = 'blockchain-line';
                    line.style.left = Math.random() * 100 + '%';
                    line.style.top = Math.random() * 100 + '%';
                    line.style.width = Math.random() * 200 + 100 + 'px';
                    line.style.transform = `rotate(${Math.random() * 360}deg)`;
                    line.style.animationDelay = Math.random() * 3 + 's';
                    bg.appendChild(line);
                }
            }
        }

        // Window event handlers
        window.addEventListener('load', async () => {
            console.log('FUL Advanced Blockchain Voting System Loading...');
            createBlockchainBackground();
            await initApp();
            updateStats();
        });

        // Handle MetaMask account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    updateStatus('disconnected', 'Please connect to MetaMask');
                    userAccount = null;
                } else {
                    userAccount = accounts[0];
                    updateStatus('connected', `Connected: ${userAccount.substring(0,8)}...`);
                }
            });
            
            window.ethereum.on('chainChanged', function (chainId) {
                window.location.reload();
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
